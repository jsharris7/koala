#! /bin/tcsh

set koala = /home/cniu/koala

if ( -e $koala/save/running ) then
    echo "koala_monitor is already running."
else
    cat > $koala/save/monitor.tcsh << EOF
touch $koala/save/running
while ( ! -e $koala/save/stop )
    bjobs -d | tail -n +2 >> $koala/save/finished.jobs
    bjobs -dl >> $koala/save/finished.details
    if ( -e $koala/save/stopped ) then
        rm $koala/save/stopped
    endif
    sleep 3600
end
rm $koala/save/stop $koala/save/running
touch $koala/save/stopped
EOF
    nohup tcsh $koala/save/monitor.tcsh &
endif
